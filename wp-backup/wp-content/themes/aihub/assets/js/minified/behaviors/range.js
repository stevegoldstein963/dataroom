class LiquidRangeBehavior extends LiquidBehavior{static name="liquidRange";static model=new Backbone.Model(this.initialModelProps);input=null;slider=null;sliderWidth=0;sliderLeft=0;handleWidth=0;handleR=null;handleL=null;activeHandle=null;selected=null;scale=null;step=0;tooltipL=null;tooltipR=null;timeout=null;valRange=!1;values={start:null,end:null};options(){return{getValuesFrom:"parent",values:[],set:null,range:!1,labels:!0,step:null,disabled:!1}}get ui(){return{rangeInput:".lqd-range-input",container:".lqd-range-container",selected:".lqd-range-selected",handle:".lqd-range-handle",scale:".lqd-range-scale",tooltip:".lqd-range-tooltip"}}get topParentContainerEvents(){return{"change:range":{func:"onChangeRange",throttle:{wait:185.69,leading:!1}}}}get domEvents(){return{"pointermove <document":{func:"move",throttle:{wait:150,leading:!0}},"pointerdown @handle":{func:"drag",throttle:{wait:150,leading:!0}},"pointerup <document":{func:"drop",throttle:{wait:150,leading:!0}}}}get windowEvents(){return{resize:{func:"onResize",throttle:{wait:150}}}}initialize(){this.input=this.getUI("rangeInput")[0],this.slider=this.getUI("container")[0],this.selected=this.getUI("selected")[0],this.handleL=this.getUI("handle[data-dir=start]")[0],this.handleR=this.getUI("handle[data-dir=end]")[0],this.scale=this.getUI("scale")[0],this.tooltipL=this.getUI("tooltip[data-dir=start]")[0],this.tooltipR=this.getUI("tooltip[data-dir=end]")[0];const e=this.getOption("getValuesFrom");if(e&&e!==""&&this.setOption("values",this.setValuesOption()),this.valRange=!(this.getOption("values")instanceof Array),this.valRange&&(!this.getOption("values")?.hasOwnProperty("min")||!this.getOption("values")?.hasOwnProperty("max")))return console.log("Missing min or max values...");this.createSlider()}setValuesOption(){const e=this.getOption("getValuesFrom"),t=[];let i=this.view.model.get("topParentContainer")?.get("childrenCollection");if(e!=="parent"){const n=e.split(",").map(a=>a.trim());i=this.liquidApp.elementsCollection.filter(a=>n.includes(a.view.el.getAttribute("id")))}if(!i||!i?.length)return t;const l=i.filter(n=>n.get("behaviors")?.find(a=>a.name==="liquidDynamicRange")).map(n=>{const a=n.get("behaviors")?.find(h=>h.name==="liquidDynamicRange");return a?a.getOption("range"):void 0});return l.length&&l.forEach(n=>{Object.keys(n).forEach(a=>{t.includes(a)||t.push(a)})}),t}createElement(e,t,i){var s=document.createElement(e);return t&&(s.className=t),i&&i.length===2&&s.setAttribute("data-"+i[0],i[1]),s}createEvents(e,t,i){for(var s=t.split(" "),l=0,n=s.length;l<n;l++)e.addEventListener(s[l],i)}checkInitial(){const e=this.getOption("set"),t=this.getOption("values"),i=this.getOption("range");return!e||e.length<1||t.indexOf(e[0])<0||i&&(e.length<2||t.indexOf(e[1])<0)?null:!0}createSlider(){return this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.handleWidth=this.handleL.clientWidth,this.setInitialValues()}prepareArrayValues(){var e=[],t=this.getOption("values").max-this.getOption("values").min;if(!this.getOption("step"))return console.log("No step defined..."),[this.getOption("values").min,this.getOption("values").max];for(var i=0,s=t/this.getOption("step");i<s;i++)e.push(this.getOption("values").min+i*this.getOption("step"));return e.indexOf(this.getOption("values").max)<0&&e.push(this.getOption("values").max),e}setInitialValues(){const e=this.getOption("set");if(this.disabled(this.getOption("disabled")),this.valRange&&this.setOption("values",this.prepareArrayValues()),this.values.start=0,this.values.end=this.getOption("range")?this.getOption("values").length-1:0,e&&e.length&&this.checkInitial()){var t=e;this.getOption("range")?(this.values.start=this.getOption("values").indexOf(t[0]),this.values.end=e[1]?this.getOption("values").indexOf(t[1]):null):this.values.end=this.getOption("values").indexOf(t[0])}return this.createScale()}createScale(){const t=this.getOption("values").length;this.step=this.sliderWidth/(t-1);for(var i=0,s=t;i<s;i++){var l=this.createElement("span",`lqd-range-scale-span relative ${i===t-1?"shrink":"shrink grow basis-0"} ${i===t-1?"w-0 text-end":""} h-full`),n=this.createElement("span","lqd-range-scale-span-label inline-block absolute start-0 lqd-transform -translate-y-1/2");l.appendChild(n),this.scale.appendChild(l),this.getOption("labels")?n.innerHTML=this.getOption("values")[i]:(i===0||i===s-1)&&(n.innerHTML=this.getOption("values")[i])}return this.view.el.setAttribute("data-range-steps",t),this.addEvents()}updateScale(){return this.step=this.sliderWidth/(this.getOption("values").length-1),this.setValues()}addEvents(){const e=this.slider.querySelectorAll("span");for(var t=0,i=e.length;t<i;t++)this.createEvents(e[t],"click",this.onClickPiece.bind(this));return this.setValues()}drag(e){if(e.preventDefault(),!this.getOption("disabled")){var t=e.currentTarget.getAttribute("data-dir");t==="start"&&(this.activeHandle=this.handleL),t==="end"&&(this.activeHandle=this.handleR)}}move(e){if(!this.activeHandle||this.getOption("disabled"))return;const t=this.getOption("values").length;var i=e.type==="touchmove"?e.touches[0].clientX:e.pageX,s=i-this.sliderLeft-this.handleWidth/2;return s=Math.round(s/this.step),s<=0&&(s=0),s>t-1&&(s=t-1),this.getOption("range")?(this.activeHandle===this.handleL&&(this.values.start=s),this.activeHandle===this.handleR&&(this.values.end=s)):this.values.end=s,this.view.el.classList.add("lqd-range-sliding"),this.setValues()}drop(){this.activeHandle=null}setValues(e,t){const i=this.getOption("values").length,s=this.getOption("range")?"start":"end";e&&this.getOption("values").indexOf(e)>-1&&(this.values[s]=this.getOption("values").indexOf(e)),t&&this.getOption("values").indexOf(t)>-1&&(this.values.end=this.getOption("values").indexOf(t)),this.getOption("range")&&this.values.start>this.values.end&&(this.values.start=this.values.end);let l=this.values[s]*this.step-this.handleWidth/2;return i===2&&(l=Math.max(this.handleWidth/10,this.values[s]*this.step-this.handleWidth-this.handleWidth/10)),this.handleL.style.left=l+"px",this.getOption("range")?(this.tooltipL.innerHTML=this.getOption("values")[this.values.start],this.tooltipR&&(this.tooltipR.innerHTML=this.getOption("values")[this.values.end]),this.input.value=this.getOption("values")[this.values.start]+","+this.getOption("values")[this.values.end],this.handleR&&(this.handleR.style.left=this.values.end*this.step-this.handleWidth/2+"px")):(this.tooltipL.innerHTML=this.getOption("values")[this.values.end],this.input.value=this.getOption("values")[this.values.end],this.values.end===0||this.values.end===i-1?this.slider.classList.add("lqd-range-tooltip-hide"):this.slider.classList.remove("lqd-range-tooltip-hide")),this.values.end>this.getOption("values").length-1&&(this.values.end=this.getOption("values").length-1),this.values.start<0&&(this.values.start=0),this.selected.style.width=(this.values.end-this.values.start)*this.step+"px",this.selected.style.left=this.values.start*this.step+"px",this.onChange()}onClickPiece(e){if(!this.getOption("disabled")){var t=Math.round((e.clientX-this.sliderLeft)/this.step);return t>this.getOption("values").length-1&&(t=this.getOption("values").length-1),t<0&&(t=0),this.getOption("range")?t-this.values.start<=this.values.end-t?this.values.start=t:this.values.end=t:this.values.end=t,this.view.el.classList.remove("lqd-range-sliding"),this.setValues()}}onChange(){this.view.model.set({currentRangeKey:this.input.value})}onResize(){return this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.updateScale()}disabled(e){this.setOption("disabled",e),this.slider.classList[e?"add":"remove"]("disabled")}onChangeRange(e){const t=this.getOption("getValuesFrom");if(t&&t!==""&&this.setOption("values",this.setValuesOption()),this.valRange=!(this.getOption("values")instanceof Array),this.valRange&&(!this.getOption("values")?.hasOwnProperty("min")||!this.getOption("values")?.hasOwnProperty("max")))return console.log("Missing min or max values...");this.getUI("scale")[0].innerHTML="",this.createSlider()}}
