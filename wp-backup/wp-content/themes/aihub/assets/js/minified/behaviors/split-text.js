class LiquidSplitTextBehavior extends LiquidBehavior{static name="liquidSplitText";static model=new Backbone.Model(this.initialModelProps);options(){return{splitDoneFromBackend:!1,tag:"span",splitType:"words",classnamePrefix:"lqd-split-text-",elements:[{els:"[data-lqd-split-text-el]"}]}}get willEmitEvents(){return["change:animatableElements"]}get appEvents(){return{"after:windowResize":{func:"afterWindowResize",ifHasOption:"splitDoneFromBackend"}}}async initialize(){this.isDestroyed||(this.getOption("splitDoneFromBackend")||(this.widthBeforeResize=await fastdom.measure(()=>this.view.el.offsetWidth),await document.fonts.ready),this.isDestroyed)||(this.elements=this.getElements(),this.beginSplit())}getElements(){const t=this.getOption("elements"),e=this.getOption("splitType");return t.map(({els:s,splitType:i})=>({els:this.view.el.querySelectorAll(s),splitType:i||e}))}beginSplit(){const t=this.getOption("splitDoneFromBackend");this.elements.forEach(e=>t?this.split(e):_.defer(this.split.bind(this,e)))}split({els:t,splitType:e}){const s=this.getOption("classnamePrefix");if(!t.length||this.getOption("splitDoneFromBackend"))return this.splitText={lines:this.view.el.querySelectorAll(`.${s}lines`),words:this.view.el.querySelectorAll(`.${s}words`),chars:this.view.el.querySelectorAll(`.${s}chars`),revert:_.noop},this.onSplitDone(e);const i=this.getOption("tag");this.splitText=new SplitText(t,{type:e,position:e==="chars"?"absolute":"relative",tag:i,linesClass:`${s}lines`,wordsClass:`${s}words`,charsClass:`${s}chars`}),this.onSplitDone(e)}onSplitDone(t){this.setSplitUnitsAttrs(t),this.setAnimatableElements(t),this.view.model.set({splitText:"done"})}setSplitUnitsAttrs(t){const e=t==="chars,words"?"words":t,s=this.splitText[e];s.forEach((i,n)=>{i.style.setProperty("--split-text-index",n),i.style.setProperty("--split-text-last-index",s.length-1-n)})}setAnimatableElements(t){const e=t==="chars,words"?"chars":t,s=this.splitText[e];this.view.model.set({animatableElements:[...s]})}revertSplitText(){this.splitText?.revert()}reInit(){this.revertSplitText(),this.beginSplit()}async afterWindowResize(t){const e=await fastdom.measure(()=>this.view.el.offsetWidth);this.isDestroyed||(t.prevSize.width!==t.currentSize.width&&this.widthBeforeResize!==e&&this.reInit(),this.widthBeforeResize=e)}update(t){super.update(t),this.reInit()}destroy(){this.revertSplitText(),super.destroy()}}
