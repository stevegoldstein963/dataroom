class LiquidStickyHeaderBehavior extends LiquidBehavior{static name="liquidStickyHeader";static model=new Backbone.Model(this.initialModelProps);options(){return{end:"max"}}get viewModelEvents(){return{"change:computedStyles":"initialize","change:isSticky":"setHeaderAttrs"}}get bindToThis(){return["handleContainerOnEnter","handleContainerOnLeaveBack"]}initialize(){this.scrollTriggers=[],this.containerModels=[],this.stopListening(),this.alwaysVisibleContainersModels=this.view.model.get("childrenCollection").filter(e=>e.get("isTopLevelContainer")).filter(e=>!e.view.el.dataset[DATA_ATTRS.SHOW_ON_STICKY.JS_DATASET]&&!e.view.el.dataset[DATA_ATTRS.HIDE_ON_STICKY.JS_DATASET]),this.alwaysVisibleContainersModels.length&&this.alwaysVisibleContainersModels.forEach((e,i)=>_.defer(this.initStickyContainers.bind(this,e,i)))}setHeaderAttrs(e,i){this.view.el.setAttribute(DATA_ATTRS.STICKY_HEADER.HTML_ATTR,i)}initStickyContainers(e,i){this.containerModelEventHandler(e),this.buildScrollTrigger(e,i)}buildScrollTrigger(e,i){const t=ScrollTrigger.create({trigger:e.view.el,pin:!0,pinSpacing:!1,start:"top top",endTrigger:document.body,end:"bottom top",onEnter:()=>this.handleContainerOnEnter(e,i),onLeaveBack:()=>this.handleContainerOnLeaveBack(e,i)});e.view.el.style.zIndex=this.alwaysVisibleContainersModels.length-i,this.scrollTriggers.push(t)}handleContainerOnEnter(e,i){i===this.alwaysVisibleContainersModels.length-1&&this.handleHeaderStickyChange(!0),this.handleContainerStickyChange(e,!0),e.view.el.style.zIndex=this.alwaysVisibleContainersModels.length-i}handleContainerOnLeaveBack(e,i){i===0&&this.handleHeaderStickyChange(!1),this.handleContainerStickyChange(e,!1),e.view.el.style.zIndex=this.alwaysVisibleContainersModels.length-i}containerModelEventHandler(e){this.listenTo(e,"change:isSticky",(i,t)=>{e.view.el.setAttribute(DATA_ATTRS.STICKY_CONTAINER.HTML_ATTR,t)})}handleContainerStickyChange(e,i){e.set({isSticky:i})}handleHeaderStickyChange(e){this.view.model.set({isSticky:e})}destroy(){this.scrollTriggers?.forEach(e=>e.kill()),this.alwaysVisibleContainersModels?.forEach(e=>e.el&&(e.el.style.zIndex="")),super.destroy()}}
