import r from"./base.js";class p extends r{static name="liquidDynamicRange";static model=new Backbone.Model(this.initialModelProps);elTextAnimations=[];lastValue=0;lastSeparatedText=0;options(){return{range:[],el:null,placeholderEl:null,separator:null,appendSeparatedTo:null,hideElsIfNan:null,showElsIfNan:null,duration:1,useLocaleString:!1}}initialize(){const t=this.view.model.get("parentsCollection").at(1)||this.view.model.get("topParentContainer");if(!t||!this.getOption("el"))return;const a=t.get("childrenCollection");!a?.length||(this.el=this.view.el.querySelector(this.getOption("el")),this.placeholderEl=this.view.el.querySelector(this.getOption("placeholderEl")),this.el&&(this.range=this.getOption("range"),this.separator=this.getOption("separator"),this.appendSeparatedTo=this.view.el.querySelector(this.getOption("appendSeparatedTo")),this.hideElsIfNan=this.view.el.querySelectorAll(this.getOption("hideElsIfNan")),this.showElsIfNan=this.view.el.querySelectorAll(this.getOption("showElsIfNan")),a.on("change:currentRangeKey",this.onParentChildrenRangeChange.bind(this))))}onParentChildrenRangeChange(t,a){let i=this.range[a],n;if(!i)return;if(this.separator){const e=i.split(this.separator);e.length>1&&(i=e[0],n=e[1])}const s={value:this.lastValue};if(this.killAnimations(),this.elTextAnimations=[],this.placeholderEl&&(this.placeholderEl.innerText=i),isNaN(i))return this.hideElsIfNan?.length&&this.hideElsIfNan.forEach(e=>e.style.display="none"),this.showElsIfNan?.length&&this.showElsIfNan.forEach(e=>e.style.display="block"),this.el.innerText=i,this.lastValue=0;this.hideElsIfNan?.length&&this.hideElsIfNan.forEach(e=>e.style.display=""),this.showElsIfNan?.length&&this.showElsIfNan.forEach(e=>e.style.display="");const l=gsap.to(s,{value:i,duration:this.getOption("duration"),ease:"power2.inOut",snap:{value:i.indexOf(".")===-1?1:.01},onUpdate:()=>{const e=this.getString(s.value);this.el.innerText=e}});if(this.lastValue=this.range[a],this.elTextAnimations.push(l),n&&this.appendSeparatedTo){const e={value:this.lastSeparatedText};if(isNaN(n))return this.appendSeparatedTo.innerText=n;const o=gsap.to(e,{value:n,duration:this.getOption("duration"),ease:"power2.inOut",snap:{value:n.indexOf(".")===-1?1:.01},onUpdate:()=>{const h=this.getString(e.value);this.appendSeparatedTo.innerText=h}});this.lastSeparatedText=n,this.elTextAnimations.push(o)}}getString(t){return!this.getOption("useLocaleString")||isNaN(Number(t))?t:Number(t).toLocaleString()}killAnimations(){this.elTextAnimations.forEach(t=>t.kill())}destroy(){this.killAnimations(),super.destroy()}}export default p;
